<%@ taglib prefix="spring" uri="http://www.springframework.org/tags" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
<script type="text/javascript" src="<spring:url value="/js/jquery/plugin/validation/jquery.validate.min.js" />"></script>
<script type="text/javascript" src="<spring:url value="/js/jquery/plugin/storage/jquery.storageapi.min.js" />"></script>
<script type="text/javascript">
   //$.sessionStorage.set('test',{a:'val'});
   var key = "message.properties";
   //ì œì´ìŠ¨ìœ¼ë¡œ ì„œë²„ì—ì„œ ë°›ì•„ì˜¤ê³  í•˜ë©´ ë ê±° ê°™ì•„ìš”!
   
   if($.sessionStorage.isEmpty(key)){//ë­ í•˜ë‚˜ë§Œë“¤ì£ ?
      $.get('<spring:url value="/rsc/i18n" />',
            {},
            function(response){
               $.sessionStorage.set(key,response);   
            });
   }
   
   //ë¹¼ì„œ ì“°ëŠ” ë©”ì†Œë“œ í•˜ë‚˜ ë§Œë“¤ì–´ë³´ì£ !
    /* function getMessage(code){
      var messages = $.sessionStorage.get(key);
      return eval("messages."+ code);//ê¼­ ì™¸ì›Œì•¼í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ í•¨ìˆ˜? eval?? 
   } */
    
   var validation = {
         //ìœ„ì˜ getMessageë©”ì„œë“œë¥¼ ì—¬ê¸° ì§‘ì–´ë„£ìŒ
          getMessage : function(code, args){ //code1ì„ í•˜ë‚˜ë”ë°›ì! ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ë§¤ê°œë³€ìˆ˜ì— ì—†ìœ¼ë©´ ê·¸ëƒ¥ ì—†ë‹¤ê³  ì·¨ê¸‰
             if(args == undefined){
            return eval("$.sessionStorage.get('"+key + "')."+code.replace(/[.]/g,"_"));
            //$.sesstionStorage.get(key).label_name; ì™€ ê°™ì€ ì˜ë¯¸ë‹¤
             }else{
                /* console.log(code);
                console.log(args); */
                   var msg = this.getMessage(code);
                for(var i=0;i<args.length;i++){
                  msg = msg.replace("{" + i + "}", isNaN(args[i])?this.getMessage(args[i]) : args[i]);
                }
                return msg;
             }
         },
         showMessage : function(errors , labelPrefix){ //ì—¬ê¸°ì„œ ì—ëŸ¬ë¥¼ ë°›ì
            //console.log($(labelPrefix + "name").text().trim()+ "_trim");
            var parent = this; //each ë°–ì—ì„œ parentì„ ì–¸í•´ì£¼ê³  ì“°ì!
            //alert(this.getMessage("label_name"));
            $(errors).each(function(index, error){
               //console.log(error);
               var args = error.arguments;
               var code = error.code;
               var field = error.field;
               var label = $(labelPrefix + field).text().trim();
               //var label = $("td#label_"+field).text(); //ì´ëŸ°ê²ƒë“¤ì€htmlí˜ì´ì§€ë§ˆë‹¤ ì¡°ê¸ˆì”©í‹€ë ¤ì§ˆìˆ˜ìˆê¸°ì— íŒŒë¼ë¯¸í„°ë¡œ ë°›ëŠ”ê²Œì¢‹ë‹¤
               label = label.length >0 ? label : labelPrefix;
               var msg = parent.getMessage(code + "_general");
               //ì—ëŸ¬ ë§¤ê°œë³€ìˆ˜ì˜ ê°¯ìˆ˜ì— ë§ê²Œ {0} ë“±ì„ ì¹˜í™˜í•˜ì!               
               if(args.length == 3){
                  //lengthê°™ì€ê²½ìš°ëŠ” ë‘ê°œë¥¼ ë°”ê¶ˆì•¼ë˜ì£ ?
                  //lengthê°™ì€ê²½ìš° 3ê°œê°€ë“¤ì–´ê°€ë‹ˆê¹ ì´ 3ê°œë¥¼ ë°”ê¾¸ê² ë‹¤!
                     msg = msg.replace("{0}",label).replace("{1}",args[2])
                     .replace("{2}",args[1]);
               }else if(args.length == 2){
                     msg = msg.replace("{0}" , label).replace("{1}",args[1]);
               }
               else{
                  msg = msg.replace("{0}",label);
               }
               $("#"+field).focus();
               alert(msg);
               
               return false; //return falseë„¤ìš”!
            });
         }
   };
   
   
   var vs = {
         config:{
            contextRoot : "<spring:url value="/" />"
         },
         session : {
            user: { 
               id : "${userInfo.username}",
               name: "${userInfo.users_name}",
               cellPhone : "${userInfo.cell_phone}",
               email : "${userInfo.email}",
               role : [<c:forEach var="val" items="${userInfo.role}">'<c:out value="${val}" />' ,</c:forEach> ]
               //c íƒœê·¸ ì“°ê² ë‹¤ê³  ì„ ì–¸ì„ í•´ì•¼í•¨!
            }
         }
   }
   
   /*
   vs.config = {
      contextRoot: "#springUrl("/")",
      locale: "${locale}",
      country: "${locale.getCountry()}",
      language: "${language}"
   };
   vs.session.user = {
      id: "$!{userSession.detail.username}",
      name: "$!{userSession.detail.name}",
      //role: [#foreach($role in $userSession.detail.role)#if ($foreach.count > 1),#end"${role}"#end],
      mfCode: "$!{userSession.detail.mfCode}",
      mfName: "$!{userSession.detail.mfName}",
      dtCode: "$!{userSession.detail.dtCode}",
      dtName: "$!{userSession.detail.dtName}",
      workNo: "$!{userSession.detail.workNo}",
      ceoName: "$!{userSession.detail.ceoName}",
      address: "$!{userSession.detail.address}",
      tel: "$!{userSession.detail.tel}",
      fax: "$!{userSession.detail.fax}",
      email: "$!{userSession.detail.email}"   
   };   //ì£¼ì„ì²˜ë¦¬í•˜ê³  ì œì´ì¿¼ë¦¬ cdnë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš”
   */
</script>
   