<%@ page language="java" contentType="text/html; charset=UTF-8"
pageEncoding="UTF-8"%>
<%@ include file="/WEB-INF/view/com/config.jsp" %>  
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
	<jsp:include page="/WEB-INF/view/com/meta.jsp" />
	<jsp:include page="/WEB-INF/view/com/favicon.jsp" />
	<jsp:include page="/WEB-INF/view/com/css.jsp" />
	<jsp:include page="/WEB-INF/view/com/script.jsp" />
	<title>candidateintroduce</title>
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
	<script src="http://code.jquery.com/jquery-2.0.3.js"></script>
	<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
	<link rel="stylesheet" type="text/css" href="<spring:url value="/css/view/candidateintroduce.css"/>"/>
	
	<script type="text/javascript">
		 $(function() {
			search();
			//loadPoster(1);
			
			$("#vote").bind("click",function(){
				window.location.href="<spring:url value="/vote/votelist" />";
			});	
			//각 후보자의 증명사진을 클릭했을때
			//밑의 포스터와 약력이 바껴야한다. 일단 처음 해결은 ajax 에 img태그에 이벤트핸들러로 메서드를 불러왔다.
					
		});
		 
		function loadPoster(candi_id){
			   alert("Candidate number "+candi_id+" 's loads poster. Ye~");
			   $.post("<spring:url value="/candi/candidatesearch"/>"
					   ,{cand_id : candi_id }
					   ,function(result){
						   console.log("profile : "+result.candi.profile);
						   console.log("filepath : "+result.candi.filepath);
						   $("#profile").html("");
						   $("#poster").html("");
						   $("#profile").append(result.candi.profile);
						   $("#poster").append("<img src=\"../file/candidownload/"+result.candi.fid+"/"+result.candi.sub_fid+"\" style=\"width:200px; height:200px;\" />");
			               
			   });
		   }
		function search(){
			   $.get("<spring:url value="/candi/candidatesearch"/>"
			         ,function(result){
			            console.log("result.candiList : " + result.candiList);
			            console.log("result.pledgeList : " + result.pledgeList);
			            $(result.pledgeList).each(function(index,pledge){
			            	console.log(pledge);
			            });
			            
			            $("#candidatePhoto").html("");//이게 html을 비우는 거에요!
			            $(result.candiList).each(function(index,candi){
			               console.log("fid : " + candi.fid);
			               var $div = $("<div style='float: left; width: 33%;'>");
			               $div.append("<img src=\"../file/download/"+candi.fid+"\" style=\"width:100px; height:100px;\" onClick=\"loadPoster("+ candi.cand_id +");\" />");
			               $("#candidatePhoto").append($div); 
			            });
			            
			            $(result.candiList).each(function(index,candi){
			              	console.log("user_name : " + candi.user_name +", cand_id : " + candi.cand_id);
			              	var $div = $("<div style='float: left; width: 33%;'>");
				            $div.append("기호 "+candi.cand_id+"번 " + candi.user_name);
				            $("#candidateName").append($div); 
			            });
			            
			            $("#tabs").html("");
			            var $ul = $("<ul>");
			            $(result.candiList).each(function(index,candi){
			            	//<li><a href="#tabs-1">공약1</a></li>
			            	var id = "tabs-"+(index + 1);
			            	var $li = $("<li>");
			            	$li.append("<a href=#"+id+">"+"기호"+(index+1)+"번 "+candi.user_name+"</a>");
			            	$ul.append($li);
			            });
			            $("#tabs").append($ul);
			            
			            $(result.candiList).each(function(index,candi){
			            	var id = "tabs-"+(index + 1);
			            	var $div = $("<div id = "+id+">");
			            	$("#tabs").append($div);
			            });
			            
			             $(result.pledgeList).each(function(index,pledge){
			            	var id = "tabs-"+pledge.cand_id;
			            	var $p = $("<p>");
			            	$p.append(pledge.pledge_contents);
				            $("#"+id).append($p);
			            }); 
			            
			             $("#tabs").tabs();
			         });
			   
			} 
			
	</script>
</head>
	<body>
	  <jsp:include page="/WEB-INF/view/top.jsp" />
	<div class="middle">
			<div class="center">
                <div>
					<div  class="content">
						<spring:message code="label.candi.introduce"/>
					</div><!-- 후보자 소개 -->
				</div>
				<br/>
				
				<div>
					<div id="candidateName" class="content">
						<div>
							<div id="candidatePhoto" class="content">
							<!--example ajax appending code  -->
								<!-- <div style="float: left; width: 33%;">사진1</div> -->
								<!-- <div style="float: left; width: 33%;">사진2</div> -->
								<!-- <div style="float: left; width: 33%;">사진3</div> -->
							</div>
						</div>
						<!-- <div style="float: left; width: 33%;">기호1번 김진호</div> -->
						<!-- <div style="float: left; width: 33%;">기호2번 염종철</div> -->
						<!-- <div style="float: left; width: 33%;">기호3번 우리나</div> -->
					</div>
				</div>
				<br/>
				<br/>
				<div>
					<div class="content">
						<input name="vote" type="button" id="vote" value="<spring:message code="label.vote.go"/>" />
                        <!-- 투표하러가기 -->
					</div>
				</div>
				<br/>
				      
				<div>
					<div class="content" >
						<div>
							<div class="content" >
								<strong> <spring:message code="label.candi.introduce.detail"/> </strong>
							</div>
						</div>
						
						<div id="poster" style="float:left; width:40%;">
						<!-- 선거 포스터가 들어갈 자리 -->
						</div>
						
						<div id="profile" style="float:left; width:60%;">
						<!-- 후보자의 약력 -->
						<div>
					</div>
				</div>
				<br/>
				
				<div>
					<div id="tabs">
					</div>
				</div>
			
			</div>
		</div>
	</div>
</div>
</body>
</html>