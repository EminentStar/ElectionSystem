<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ include file="/WEB-INF/view/com/config.jsp"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<jsp:include page="/WEB-INF/view/com/meta.jsp" />
<jsp:include page="/WEB-INF/view/com/favicon.jsp" />
<jsp:include page="/WEB-INF/view/com/css.jsp" />
<jsp:include page="/WEB-INF/view/com/script.jsp" />
<!-- 여기다 스크립트하나만듭니다 버튼에다 이벤트 달아야죠? 눌렀을때 뭐해라~-->
<script type="text/javascript">
	String.prototype.trim = function(){
		 return this.replace(/(^\s*)|(\s*$)/gi, ""); 
		 //이건 정규식이고 자바스크립트에서 정규식을쓸때 /로 시작하고 ()로 묶으면 하나의 문단같은걸으미해요 
		 //^꺽쇠면 글자의 시작 시작하는 문자가 공백이고 나머지는 다상관없다! 
		 //첫번쨰가 공백이거나 맨뒤가 공백이다? 그러면 이거는 여러개가 나와도 다바꾸겠다! 라는 의미가 됩니다
	};

		$(function(){
			 //이렇게 호출하면되는거같아요?
			$.validator.addMethod( //외워야함 정규식을 하기위해 쓴거고 다른걸 체크하기위해 만들거다  자바스크립트에선 정규식을 사용하지 못하니깐 이거 집에가서 공부해보자
					"regex",
					function(value,element,regexp){
						var re = new RegExp(regexp);
						return this.optional(element) || re.test(value);
					},
					"Please check your input."
					);
			$("#joinForm").validate({
				rules:{
					cid: {//JSON은 키밸류형식이니깐 맞춰야되요?
						required : true,
						/* minlength : 6,
						maxlength : 18 */
						rangelength : [6,18]  //범위설정
					},
					passwd : {
						required : true,
						rangelength : [6,12]
					},
					repasswd : {
						equalTo: "#passwd"
					},
					name : {
						required : true,
						rangelength : [2,12]
					},
					cellPhone : {
						maxlength : 15,
						regex : /^01([0|1|6|7|9]?)-([0-9]{3,4})-?([0-9]{4})$/
					},
					email : {
						maxlength : 50,
						//email : true
						regex :  /[a-z0-9]{2,}@[a-z0-9-]{2,}.[a-z0-9]{2,}/i
					}
				},
				messages:{
					cid: {
						<spring:message code ="label.id" var="cid" /> //이걸찍지않고 변수로 선언할래!
						required : "<spring:message code="NotEmpty.general" arguments="${cid}" />",
						/* minlength : "6자 이상으로 입력하세요.",
						maxlength : "18자 이하로 입력하세요" */
						rangelength : "<spring:message code="Length.general" arguments="${cid},6,18" />"
					},
					passwd : {
						<spring:message code ="label.password" var="cpasswd" />
						required : "<spring:message code="NotEmpty.general" arguments="${cpasswd}" />",
						rangelength : "<spring:message code="Length.general" arguments="${cpasswd},6,12" />"
					},
					repasswd : {
						equalTo: "<spring:message code="EqualTo.password" />"
					},
					name : {
						<spring:message code ="label.name" var="name" /> //이걸찍지않고 변수로 선언할래!
						required : "<spring:message code="NotEmpty.general" arguments="${name}" />",
						/* minlength : "6자 이상으로 입력하세요.",
						maxlength : "18자 이하로 입력하세요" */
						rangelength : "<spring:message code="Length.general" arguments="${name},2,12" />"
					},
					cellPhone : {
						//Length.max.general={0}은(는) {1}자 이내로 입력해 주세요.
						//Invalid.format.general={0} 형식이 올바르지 않습니다. 예){1}
						<spring:message code="label.cellphone" var="phone" />
						maxlength : "<spring:message code="Length.max.general" arguments="${phone},15" />",
						regex : "<spring:message code="Invalid.format.general" arguments="${phone},010-1111-2222"/>"
					},
					email : {
						//Email.email=이메일 형식이 올바르지 않습니다. 예)support@javabugs.net
						<spring:message code="label.email" var="email" />
						maxlength : "<spring:message code="Length.max.general" arguments="${email},50" />",
						regex : "<spring:message code="Email.email" />"
					}
				}
			});
			
			$("input[name=regBtn]").bind('click',function(){
				//url엔 뭘넣느냐?join컨트롤러에 뭘만들어야죠?checkValidation메소드를 쓰도록하죠
				console.log($("#joinForm").valid());
				if($("#joinForm").valid()){//바뀐부분
				$.get('<spring:url value="/join/checkValidation" />',
						{"cid":$("#cid").val()} ,
				function(result){
					if(!result.data.cid){
						//이미 사용중인 아이디 입니다
						alert("<spring:message code="Duplicate.cid" />");
					}else{
						//회원 가입 진행
						$.post('<spring:url value="/join/create" />' ,
								$("#joinForm").serialize(),
								function(result){
									//다른방법?
								if(result.data != null  &&  result.data.error != undefined ){
										console.log(result.data.error);
										validation.showMessage(result.data.error,"td#label_");
								}else{
									//로그인 페이지로 보내자
									alert("<spring:message code="msg.alert.complete.join" />");
									window.location.href = "<spring:url value = "/login" />";
									
								}
						});
					}
				});
			//아이디는 한글이없기에 겟으로 보내도 무방 (url,parameter, callback메서드)
				}
			});
		});
		
	</script>
<%--
	 <jsp:include page="../../css/view/menu.css" /> 
	--%>
<title><spring:message code="label.join.title" /></title>
</head>
<body>
	<form id="joinForm">
		<table>
			<tr>
				<td id="label_cid"><spring:message code="label.id" /></td>
				<td><input type="text" name="cid" id="cid" /></td>
			</tr>
			<tr>
				<td id="label_passwd"><spring:message code="label.password" /></td>
				<td><input type="password" name="passwd" id="passwd" /></td>
			</tr>
			<tr>
				<td><spring:message code="label.repassword" /></td>
				<td><input type="password" name="repasswd" id="repasswd" /></td>
			</tr>
			<tr>
				<td id="label_name"><spring:message code="label.name" /></td>
				<td><input type="text" name="name" id="name" /></td>
			</tr>
			<tr>
				<td id="label_cellPhone"><spring:message code="label.cellphone" /></td>
				<td><input type="text" name="cellPhone" id="cellPhone" /></td>
			</tr>
			<tr>
				<td id="label_email"><spring:message code="label.email" /></td>
				<td><input type="text" name="email" id="email" /></td>
			</tr>
			<tr>
				<td colspan="2" align="right"><input type="button"
					name="regBtn" value="회원가입" /></td>
			</tr>
		</table>
	</form>
</body>
</html>